<!doctype html>
<html>
<head>
    <link href="qunit-git.css" type="text/css" rel="stylesheet" />
</head>
<body>
    <h2>Shortest/All Paths</h2>
    <h1 id="qunit-header">QUnit example</h1>  
    <h2 id="qunit-banner"></h2>  
    <h2 id="qunit-userAgent"></h2>  
    <ol id="qunit-tests">  

    <script type="text/javascript" src="jquery-1.7.1.js"></script>
    <script type="text/javascript" src="qunit-git.js"></script>
    <script type="text/javascript">
        (function () {
            "use strict";
            /*
              to do:
             * create graph randomizer
             * find shortest unique paths
             * report output
             * graph visualizer (raphael?)
             * modularize (require.js?)
             * allPaths a method on Node?
             * Node needs undirected edges!
             * access nodes by both name and index!
             * path API is cumbersome!

            */

            function createNode(name, children) {
                var _name = name || '',
                    _children = children || [],
                    that = {
                        name: _name,
                        children: _children,
                        hasChild: function(c) {
                            return _children.indexOf(c) !== -1;
                        },
                        add: function(c) {
                            // edges need to be bi-directional, so add to
                            // children too
                            if (!that.hasChild(c)) {
                                _children.push(c);
                            }
                            if (!c.hasChild(that)) {
                                c.children.push(that);
                            }
                        },
                        toString: function() { return _name; }
                    };

                $.each(_children, function(i,c) {
                    that.add(c);
                });

                return that;
            };

            /**
            createPath - immutable path data structure.
            `add` does not modify the current instance, it 
            returns a new instance with the new node added
            */
            function createPath(arr) {
                var _arr = arr || [];

                return {
                    contains: function (node) {
                        return _arr.indexOf(node) !== -1;
                    },
                    add: function (node) {
                        // copy path array, add new node, return new path
                        var a = _arr.slice(0);
                        a.push(node);
                        return createPath(a);
                    },
                    get: function () {
                        return _arr.slice(0);
                    }

                };
            }

            function allPaths(node, dest) {

                var paths = [];
                _allPaths(node, dest, createPath());
                return paths;

                function _allPaths(node, dest, path) {
                    var i, newPath;

                    // abort traversal if we're in a loop
                    if (path.contains(node)) {
                        return;
                    }

                    newPath = path.add(node);
                    if (node === dest) {
                        // abort traversal and return the 
                        paths.push(newPath);
                        return;
                    }

                    for (i = 0; i < node.children.length; i++) {
                        _allPaths(node.children[i], dest, newPath);
                    }
                }
            }



            /*
            QUnit tests
            http://docs.jquery.com/QUnit
            */
            test("createNode should assign node name", function() {
                var n = createNode("foo");

                equal(n.name, "foo");
            });
            test("should return single node if src and dest are equal", function () {
                var n = createNode("s"),
                    paths;

                paths = allPaths(n, n);

                equal(paths.length, 1);
                equal(paths[0].get().length, 1);
                equal(paths[0].get()[0].name, "s");
            });
            test("handles loops correctly", function() {

                var d = createNode("d"),
                    n = createNode("s", [
                          createNode("1", [
                            createNode("3", [d])
                          ]),
                          createNode("2", [
                            createNode("4", [d])
                          ]),
                        ]),
                    paths;

                // add cycles: 3-2
                n.children[0].children[0].add(
                  n.children[1]
                );

                paths = allPaths(n, d);

                equal(paths.length, 4);
            });
        })();
    </script>
</body>
</html>
